<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Background Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }
        iframe {
            width: 80%;
            height: 80%;
            border: none;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <iframe id="main-screen" src="https://proof-files-git-main-matans-projects-4d48d79b.vercel.app/mainscreen.html"></iframe>
    <script>
        class Background {
            constructor() {
                this.urls = {
                    main: "https://proof-files-git-main-matans-projects-4d48d79b.vercel.app/mainscreen.html",
                    ringing: "https://proof-files-git-main-matans-projects-4d48d79b.vercel.app/ringing.html",
                    inCall: "https://proof-files-git-main-matans-projects-4d48d79b.vercel.app/incall.html",
                    incomingCall: "https://proof-files-git-main-matans-projects-4d48d79b.vercel.app/incomingcall.html"
                };
                this.iframe = document.getElementById("main-screen");
            }

            setPage(pageId, param = {}) {
                if (this.iframe) {
                    let url = this.urls[pageId];
                    if (Object.keys(param).length >= 1) {
                        url += `?${param.key}=${param.value}`;
                    }
                    this.iframe.src = url;
                }
            }

            handleData(_data) {
                try {
                    const data = typeof _data === 'string' ? JSON.parse(_data) : _data;
                    const { action, body } = data;
                    switch (action) {
                        case 'ringing':
                            this.setPage('ringing', { key: "to", value: body.to });
                            break;
                        case 'call-started':
                            this.setPage('inCall', { key: "to", value: body.from });
                            break;
                        case 'call-ended':
                            this.setPage('main');
                            break;
                        case 'receiving-call':
                            this.setPage('incomingCall', { key: "from", value: body.from });
                            break;
                        default:
                            console.log('Unknown action:', action);
                            break;
                    }
                } catch (error) {
                    console.error("Error handling data:", error);
                }
            }
        }

        const background = new Background();

        window.addEventListener('message', function (event) {
            if (event.origin !== window.location.origin) {
                return;
            }

            background.handleData(event.data);
        }, false);
    </script>
</body>
</html>
