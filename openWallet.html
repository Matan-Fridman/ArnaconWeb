<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Semaphore Identity Generation</title>
    <script src="https://unpkg.com/circomlibjs@0.1.7/build/main.cjs"></script>
    <script type="module">
        import { ed25519 } from 'https://cdn.jsdelivr.net/npm/@noble/curves@1.7.0/esm/ed25519.js';
        import { poseidon } from 'https://cdn.jsdelivr.net/npm/@noble/curves@1.7.0/esm/poseidon.js';

        async function generateSemaphoreIdentity() {
            // Generate a random private key
            const privateKey = ed25519.utils.randomPrivateKey();

            // Derive the public key
            const publicKey = ed25519.getPublicKey(privateKey);

            // Compute the Poseidon hash of the public key to create the commitment
            const identityCommitment = poseidon([publicKey]);

            console.log("Private Key:", privateKey);
            console.log("Public Key:", publicKey);
            console.log("Identity Commitment:", identityCommitment);
        }

        generateSemaphoreIdentity();

        document.getElementById("send-transaction").addEventListener("click", async () => {
            const to = "0xA96abD7db9c94a339B95EDC82B51099Cc3B1c56a"; // Replace with the recipient address
            const value = "0"; // Amount of ETH to send, in Wei
            const randomData = Math.floor(Math.random() * 1000000).toString(16); // Random number in hex
            const data = await generateCommitment(); // Generate Semaphore commitment

            const chainId = 80002; // Replace with the correct chain ID (80001 for Mumbai Testnet)
            const jsonData = {
                "action": "sign-commitment",
                "body": {
                    "content": data
                }
            };

            if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.nativeHandler) {
                window.webkit.messageHandlers.nativeHandler.postMessage(JSON.stringify(jsonData));
            } else if (window.AndroidBridge && window.AndroidBridge.processAction) {
                console.log(JSON.stringify(jsonData));
                window.AndroidBridge.processAction(JSON.stringify(jsonData));
            } else {
                console.log("Native interface not available");
            }
        });
    </script>
</body>
</html>
